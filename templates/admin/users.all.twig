{% extends "site.twig" %} 

{% block title %}Admin / Users {% endblock %} 

{% block content %}
<div class="row-fluid">
	<div class="span3">
	<div class="widget">
		<div class="widget-header">
		<h3>User Action</h3>
		</div>
		<div class="widget-content"> 
		
		
		
				<form id="batchuser">
					
				<fieldset>
         			<legend>Add batch of users</legend>
         			 <p>
            			<label>Select Group</label>
			            <select id="group" name="group">
			            	{% for item in data %}
               					<option value = "{{ item.group.id }}">{{ item.group.name }}</option>
               				{% endfor %}
             			</select>
          			</p>
          			<p>
            			<label>Count</label>
			            <input type="number" min="1" max="50" step="1" name="count" id="count" value="20">
          			</p>       			
          			<p>
            			<label>Username stub</label>
			            <input type="text" name="pattern" id="pattern" value="">
          			</p>
          			</fieldset>
          			<p>
          			
          			</p>
				</form>
				<button class="btn" id="generate-users">Generate</button>
				
		</div>
		<div class="widget-content"> 				
				<table id="generate-output" style="width: 100%">
				</table>
				
			</div> 
	</div>
	
	<div class="widget">
		<div class="widget-header">
		<h3>Group Action</h3>
		</div>
		<div class="widget-content"> 
				<p> </p>
			</div> 
	</div>
	</div>

<div class="span9">
	
	{% for item in data %}
		<div class="widget">
			<div class="widget-header">
				<h3>{{ item.group.name }}</h3>
			</div>
			<div class="widget-content"> 

				<table class="table table-condensed table-striped table-bordered">
				<thead>
					<tr>
						<th width="5%">#</th>
						<th>ID</th>
						<th>Name</th>
						<th>Active</th>
						<th class="td-actions">Drafts</th>
					</tr>
				</thead>
				<tbody>
					{% for user in item.users %}
					<tr class={{ user.isadmin? "info" : ""}}>
					<td><code>{{ user.id }}</code></td>
					<td>{{ user.username }}</td>
					<td>{{ user.name }}</td>

					<td>{% if user.active %}<i class="icon-check"></i>{% endif %}
					<td><span class="badge {{ user.drafts?'badge-info' }}">{{ user.drafts?:""}}</span></td>
				
					</tr>
					{% endfor %}
				</tbody>
				</table>
			
			</div> 
		</div>
	{% endfor %}
	</div>
</div>


{% endblock %}


{% block injectJS %}
	{{ parent() }}
<script id="script-batchusers">
var bindBatchUser = function(e) {
	
	var id = $("form#batchuser #group").val();
	var stub = $("form#batchuser #pattern").val();
	var nb = $("form#batchuser #count").val();
	console.log(id,stub,nb);
	$.ajax({
		type : "POST",
		method: "post",
		url : "{{ urlFor('admin.task.postadduser')}}", // URL and function to call
		data : {
			"id":id,
			"nb":nb,
			"pattern":stub
			}, 
		//contentType : "application/json; charset=utf-8",
		//processData : true,
		dataType : "json",
		success : function(msg, status) {
			// Set Response outcome
			
			
			
			$.each(msg.users, function(index, element) {
				var placeholder = $("<tr/>");

				$("<td/>",{ "text": msg.groupname, "style" : "width:25%"})
					.appendTo(placeholder);				
				$("<td/>",{ "text": element.username, "style" : "width:50%"})
					.appendTo(placeholder);
				$("<td/>",{ "text": element.pwd, "style" : "width:50%"})
					.appendTo(placeholder);
					
				placeholder.appendTo($("#generate-output"));
				
				});
		},
		error : function(xhr, msg, e) {
			// this should only fire if the ajax call did not happen or
			// there was an unhandled exception
			console.log(msg);
		}
	});	
	
};

$(document).ready(function() {
	$("#generate-users").click(bindBatchUser);
});


</script>

{% endblock %}