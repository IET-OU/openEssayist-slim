{% extends "site.twig" %} 
{% import "widgets/ngram.macro.twig" as ngram %}

{% block title %}Assignments{% endblock %} 


{% block bccontainer %}		
	{% include "widgets/breadcrumb.panel.twig" %}
	    <li><div class="btn-group">
    	<button class="btn btn-small active disabled" >
    			<i class="icon-pencil"></i><span class="hidden-phone hidden-tablet"> {{ task.name }}</span></button>
	</div></li>
	
{% endblock %}

{% block content %}
<div class="row-fluid"><div class="span12">
<div class="widget" data-toggle="collapse" data-target="#demo" style="cursor: pointer;">
			<div class="widget-header" >
				<h3>Show Assignment information</h3>
				<div class="box-icon">
					<a class="btn-setting" href="#"><i class="icon-chevron-down"></i></a>
				</div>
			</div>
			</div> 

</div></div>

<div class="row-fluid collapse" id="demo">
	<div class="span2">
		<div class="widget">
			<div class="widget-header">
			<h3> {{ group.name }}</h3>
			</div>
			<div class="widget-content"> 
					<p> 
					{{ group.description|length > 90 ? group.description|slice(0, 90) ~ '...' : group.description  }}</p>
				</div> 
		</div>
	</div>
	<div class="span8">
		<div class="widget">
			<div class="widget-header">
			<h3> Assignment</h3>
			</div>
			<div class="widget-content"> 
					<p>{{ task.assignment|nl2br}} </p>
				</div> 
		</div>
	</div>
	<div class="span2">
		<div class="widget">
			<div class="widget-header">
			<h3> Deadline </h3>
			</div>
			<div class="widget-content"> 
					<p>{{ task.deadline}}</p>
			</div> 
		</div>
		<div class="widget">
			<div class="widget-header">
				<h3> Word Limit</h3>
			</div>
			<div class="widget-content"> 
				<p>{{ task.wordcount}}</p>
			</div> 
		</div>
	</div>	
</div>

<div class="row-fluid">
<div class="span12">
		<div class="widget">
			<div class="widget-header">
				<h3>Review</h3>
			</div>
			<div class="widget-content"> 

    
    {% if drafts is empty %}
    	<div class="alert alert-block">
    		{#<button type="button" class="close" data-dismiss="alert">&times;</button>#}
	    	<h4>Submit a draft</h4>
	    	<p>Before we can do anything, you need to submit a draft to the system</p>
	    	
	    	<p>
	    	<a class="btn btn-success"  href="{{ urlFor('me.draft.submit',{"idt":task.id}) }}">Submit a new draft...</a>
	    	</p>		    	
	    </div>			
    {% elseif drafts[0].processed == 1 %}

    	<div class="alert alert-success">
    		<button type="button" class="close" data-dismiss="alert">&times;</button>
	    	<h4>Draft submitted & reviewed</h4>
    		Draft has been submitted. Proceed with the suggestions arising from the analysis of your text.
	    </div>			
    {% if usermodel.keyword is empty %}
    	<div class="alert alert-block">
    		{#<button type="button" class="close" data-dismiss="alert">&times;</button>#}
	    	<h4>Structure</h4>
	    	<p>OpenEssayist tried to identified the structure of your essay (introduction, conclusion, ...)</p>
			<p>You can explore it :
				<a href="{{ urlFor('me.draft.show',{"draft":drafts[0].id}) }}" class="btn btn-small" >In the main text...</a>
				<a href="{{ urlFor('me.draft.view.structure',{"draft":drafts[0].id}) }}" class="btn btn-small" >As metrics ...</a>
			</p>			
		    	
	    </div>	
    	<div class="alert alert-block">
    		{#<button type="button" class="close" data-dismiss="alert">&times;</button>#}
	    	<h4>Summary</h4>
	    	<p>OpenEssayist has created a summary of your essay, by extracting the most "important" sentences in it.</p>
			<p>You can explore it: 
				<a href="{{ urlFor('me.draft.sentence',{"draft":drafts[0].id}) }}" class="btn btn-small" >As an abstract...</a> 
			</p>			
		    	
	    </div>		    
    <div class="alert alert-block">
    		{#<button type="button" class="close" data-dismiss="alert">&times;</button>#}
	    	<h4>Keywords</h4>
	    	<p>OpenEssayist has identified the most "important" keywords in your text.</p>
			<p>You can explore them here: 
				<a href="{{ urlFor('me.draft.keywords',{"draft":drafts[0].id}) }}" class="btn btn-small" >In a "keywords cloud" ...</a> 
				<a href="{{ urlFor('me.draft.show',{"draft":drafts[0].id}) }}" class="btn btn-small" >In the main text ...</a> 
				<a href="{{ urlFor('me.draft.view.dispersion',{"draft":drafts[0].id}) }}" class="btn btn-small" >As a dispersion graph...</a> 
				<a href="{{ urlFor('me.draft.view.graph',{"draft":drafts[0].id,"graph":"graphke"}) }}" class="btn btn-small" >As a network...</a> 
			</p>			
			<p>A good thing to do is to organise these keywords into your own categories.</p>
	    		    	
	    	<p>	
	    	<a class="btn btn-success"  href="{{ urlFor('me.draft.act.keyword',{"draft":drafts[0].id}) }}">Organise your keywords ...</a>
	    	</p>		    	
	    </div>	
	    <div class="alert alert-error">
    		{#<button type="button" class="close" data-dismiss="alert">&times;</button>#}
	    	<h4>Submit a new draft</h4>
	    	<p>There are still a few issues above that need to be closed before being able to submit the next draft.</p>
	    	<p>
	    	<a class="btn btn-success"  href="{{ urlFor('me.draft.submit',{"idt":task.id}) }}">Submit a new draft...</a>
	    	</p>		    	
	    </div>			
	    		
    {% endif %}    
    {% else %}
        	<div class="alert alert-error">
	    	<h4>Draft is being analysed</h4>
    		Draft has been submitted and is being analysed. check this page again in a few seconds. 
	    </div>			
    
	{% endif %}
			
			
			</div>
		</div>
</div>
</div>

<div class="row-fluid">
<div class="span12">
		<div class="widget">
			<div class="widget-header">
				<h3>History</h3>
			</div>
			<div class="widget-content"> 

				<table class="table table-condensed table-striped table-bordered">
				<thead>
					<tr>
						<th width="5%">#</th>
						<th>Date</th>
						<th>Word Count</th>
						<th>Key Words</th>
						<th class="td-actions">Actions</th>
					</tr>
				</thead>
				<tbody>
				{% for draft in drafts %}
				<tr>
					<td><code>{{ draft.id }}</code></td>
					<td style="white-space: nowrap;">{{ draft.date | date("Y-m-d")}}<br><small>({{ draft.datesince }} ago)</small></td>
					<td>{{ draft.wordcount }}</td>
					<td>{% for item in draft.keywords[0:7] %} 
						{{ ngram.toBtn(item) }}
						{% endfor %}</td>
					<td>
					{% if draft.processed == -1 %}				
						<a class="btn btn-danger"  href="{{ urlFor('me.draft.show',{"draft":draft.id}) }}">Try Again</a>
					{% elseif draft.processed == 0 %}				
						<a class="btn  btn-warning"  href="{{ urlFor('me.draft.show',{"draft":draft.id}) }}">Waiting</a>
					{% else %}				
						<a class="btn btn-primary"  href="{{ urlFor('me.draft.show',{"draft":draft.id}) }}">Show</a>
					{% endif %}
					</td>
				</tr>
				{% endfor %}
				
				</tbody>
				</table>
			</div>
			{% if auth.user.isadmin %}
			<div class="widget-content">
			<a class="btn btn-success"  href="{{ urlFor('me.draft.submit',{"idt":task.id}) }}">Submit a new draft...</a>
			</div>
			{% endif %}
		</div>
	</div>
</div>

{% endblock %}